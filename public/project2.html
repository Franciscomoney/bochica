<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bochica - Project Tasks</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen">
  <div class="max-w-4xl mx-auto p-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-2">Bochica Project Tasks</h1>
      <p class="text-gray-600">Real-time task tracking for smart contract implementation</p>
      <p class="text-sm text-gray-500 mt-2">Last updated: <span id="lastUpdate"></span></p>
    </div>

    <!-- Design Document Link -->
    <div class="text-center mb-4">
      <a href="/SMART-CONTRACT-DESIGN.md" target="_blank" class="text-blue-600 hover:underline font-semibold">
        📄 View Smart Contract Design Document
      </a>
    </div>

    <!-- Current Task Section -->
    <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 mb-6">
      <h2 class="text-xl font-bold text-blue-900 mb-2">🔄 Currently Working On:</h2>
      <p id="currentTask" class="text-lg text-blue-800">Creating this project management page</p>
    </div>

    <!-- Tasks List -->
    <div class="bg-white rounded-xl shadow-lg p-8 border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Task List</h2>
      
      <div id="tasksList" class="space-y-4">
        <!-- Tasks will be loaded here -->
      </div>
    </div>

    <!-- Add Task Form (for Claude to update) -->
    <div class="mt-8 bg-white rounded-xl shadow-lg p-8 border border-gray-200">
      <h3 class="text-xl font-bold text-gray-900 mb-4">Update Task Status</h3>
      <div class="space-y-4">
        <input 
          type="text" 
          id="taskInput" 
          placeholder="Task description..." 
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
        />
        <select id="statusSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
          <option value="pending">Pending</option>
          <option value="in_progress">In Progress</option>
          <option value="completed">Completed</option>
          <option value="blocked">Blocked</option>
        </select>
        <button 
          onclick="addTask()" 
          class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700"
        >
          Add/Update Task
        </button>
      </div>
    </div>

    <!-- Deployment Information -->
    <div class="mt-8 bg-purple-50 border-2 border-purple-200 rounded-xl p-6">
      <h3 class="text-xl font-bold text-purple-900 mb-4">🚀 Ready for Deployment</h3>
      <div class="space-y-3 text-purple-800">
        <p><strong>Target:</strong> Paseo Asset Hub (Testnet)</p>
        <p><strong>Contract File:</strong> <code class="bg-white px-2 py-1 rounded">bochica_lending_v2.contract</code> (38 KB)</p>
        <p><strong>Network:</strong> <a href="https://polkadot.js.org/apps/?rpc=wss://paseo-asset-hub-rpc.polkadot.io#/contracts" target="_blank" class="text-blue-600 hover:underline">Paseo Asset Hub →</a></p>
        <p><strong>Faucet:</strong> <a href="https://faucet.polkadot.io/paseo" target="_blank" class="text-blue-600 hover:underline">Get testnet PAS →</a></p>
        <div class="mt-4 bg-white rounded p-4">
          <p class="text-sm font-mono text-gray-700">Download command:</p>
          <code class="text-xs bg-gray-100 px-2 py-1 rounded block mt-2">scp debian@51.178.253.51:/home/debian/bochica/contracts/bochica_lending_v2/target/ink/bochica_lending_v2.contract ~/Downloads/</code>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Task data stored in localStorage
    const TASKS_KEY = 'bochica_tasks';

    // Initialize with default tasks
    const defaultTasks = [
      {
        id: 1,
        description: "Create escrow wallet per project",
        status: "pending",
        created: new Date().toISOString()
      },
      {
        id: 2,
        description: "Update deposit UI to show escrow address",
        status: "pending",
        created: new Date().toISOString()
      },
      {
        id: 3,
        description: "Implement withdrawal with 2% commission",
        status: "pending",
        created: new Date().toISOString()
      },
      {
        id: 4,
        description: "Add repayment tracking to escrow",
        status: "pending",
        created: new Date().toISOString()
      },
      {
        id: 5,
        description: "Test complete lending cycle",
        status: "pending",
        created: new Date().toISOString()
      }
    ];

    // Load tasks from localStorage or use defaults
    function loadTasks() {
      const stored = localStorage.getItem(TASKS_KEY);
      return stored ? JSON.parse(stored) : defaultTasks;
    }

    // Save tasks to localStorage
    function saveTasks(tasks) {
      localStorage.setItem(TASKS_KEY, JSON.stringify(tasks));
      renderTasks();
    }

    // Render tasks
    function renderTasks() {
      const tasks = loadTasks();
      const container = document.getElementById('tasksList');
      
      // Update current task
      const inProgress = tasks.find(t => t.status === 'in_progress');
      document.getElementById('currentTask').textContent = 
        inProgress ? inProgress.description : 'No task in progress';
      
      // Update timestamp
      document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
      
      // Render all tasks
      container.innerHTML = tasks.map(task => {
        const statusColors = {
          pending: 'bg-gray-100 text-gray-700',
          in_progress: 'bg-blue-100 text-blue-700',
          completed: 'bg-green-100 text-green-700',
          blocked: 'bg-red-100 text-red-700'
        };
        
        const statusIcons = {
          pending: '⏳',
          in_progress: '🔄',
          completed: '✅',
          blocked: '🚫'
        };
        
        return `
          <div class="flex items-center justify-between p-4 border rounded-lg ${statusColors[task.status]}">
            <div class="flex items-center space-x-3 flex-1">
              <span class="text-2xl">${statusIcons[task.status]}</span>
              <span class="font-medium">${task.description}</span>
            </div>
            <div class="flex items-center space-x-2">
              <span class="text-xs px-2 py-1 rounded ${statusColors[task.status]}">${task.status.replace('_', ' ').toUpperCase()}</span>
              ${task.status !== 'completed' ? `
                <button onclick="updateTaskStatus(${task.id}, 'completed')" class="text-green-600 hover:text-green-800">
                  Mark Done
                </button>
              ` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    // Add new task
    function addTask() {
      const input = document.getElementById('taskInput');
      const status = document.getElementById('statusSelect').value;
      
      if (!input.value.trim()) return;
      
      const tasks = loadTasks();
      const newTask = {
        id: tasks.length + 1,
        description: input.value,
        status: status,
        created: new Date().toISOString()
      };
      
      tasks.push(newTask);
      saveTasks(tasks);
      input.value = '';
    }

    // Update task status
    function updateTaskStatus(id, newStatus) {
      const tasks = loadTasks();
      const task = tasks.find(t => t.id === id);
      if (task) {
        task.status = newStatus;
        saveTasks(tasks);
      }
    }

    // Auto-refresh every 5 seconds
    setInterval(renderTasks, 5000);

    // Initial render
    renderTasks();
  </script>
</body>
</html>
